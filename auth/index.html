<!DOCTYPE html>
<html>
<head>
    <title>Authentication</title>
</head>
<body>
    <form id="authForm">
        <label for="studentId">Student ID:</label>
        <input type="text" id="studentId" name="studentId">
        <button type="submit">Submit</button>
    </form>

    <script>
        document.getElementById('authForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const studentId = document.getElementById('studentId').value;
            const params = new URLSearchParams(window.location.search);

            // Check if student ID is in the correct format
            if (!/^\d{7}$/.test(studentId)) {
                alert('Student ID must be 7 digits long and contain only numbers.');
                return; // Stop execution if format is incorrect
            }

            if (params.has('cancelReq')) {
                // Redirect to cancel.html with the student ID
                window.location.href = `../client/cancel.html?studentId=${studentId}`;
            }
            else if (params.has('adminLogin')) {
                // Check if student ID is in the admin list
                fetch('adminid.txt')
                    .then(response => response.text())
                    .then(data => {
                        const adminIds = data.split('\n');
                        if (adminIds.includes(studentId)) {
                            // Redirect to room_status since admin is authenticated
                            window.location.href = `../admin/room_status.html?studentId=${studentId}`;
                        } else {
                            alert('Student ID is not authorized as an admin.');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching admin IDs:', error);
                        alert('An error occurred. Please try again later.');
                    });
            } else {
                // Simulate authentication (replace with actual authentication logic)
                const isAuthenticated = studentId !== '-1';

                if (isAuthenticated) {
                    const date = params.get('date');
                    const room = params.get('room');
                    const timeslot = params.get('timeslot');
                    const options = params.get('options');

                    // Redirect back to book.html with the student ID
                    window.location.href = `../client/book.html?date=${date}&room=${room}&timeslot=${timeslot}&options=${options}&studentId=${studentId}`;
                } else {
                    alert('Authentication failed. Please try again.');
                }
            }
        });

    </script>
</body>
</html>
